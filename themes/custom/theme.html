<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Dear API Providers - Misir's Blog</title>

    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Faustina:ital,wght@0,300..800;1,300..800&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
          rel="stylesheet"/>
    <link rel="stylesheet" href="./theme.css"/>
</head>
<body>

<nav>
    <div class="nav">
        <ul class="nav-menu">
            <li><a href="#">Home</a></li>
            <li class="active"><a href="#">Blog</a></li>
            <li><a href="#">Projects</a></li>
            <li><a href="#">Photos</a></li>
            <li><a href="#">Discovery</a></li>
        </ul>

        <ul class="nav-menu">
            <li>
                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-brand-twitter">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M14.058 3.41c-1.807 .767 -2.995 2.453 -3.056 4.38l-.002 .182l-.243 -.023c-2.392 -.269 -4.498 -1.512 -5.944 -3.531a1 1 0 0 0 -1.685 .092l-.097 .186l-.049 .099c-.719 1.485 -1.19 3.29 -1.017 5.203l.03 .273c.283 2.263 1.5 4.215 3.779 5.679l.173 .107l-.081 .043c-1.315 .663 -2.518 .952 -3.827 .9c-1.056 -.04 -1.446 1.372 -.518 1.878c3.598 1.961 7.461 2.566 10.792 1.6c4.06 -1.18 7.152 -4.223 8.335 -8.433l.127 -.495c.238 -.993 .372 -2.006 .401 -3.024l.003 -.332l.393 -.779l.44 -.862l.214 -.434l.118 -.247c.265 -.565 .456 -1.033 .574 -1.43l.014 -.056l.008 -.018c.22 -.593 -.166 -1.358 -.941 -1.358l-.122 .007a.997 .997 0 0 0 -.231 .057l-.086 .038a7.46 7.46 0 0 1 -.88 .36l-.356 .115l-.271 .08l-.772 .214c-1.336 -1.118 -3.144 -1.254 -5.012 -.554l-.211 .084z"/>
                    </svg>
                </a>
            </li>

            <li>
                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-brand-github">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M5.315 2.1c.791 -.113 1.9 .145 3.333 .966l.272 .161l.16 .1l.397 -.083a13.3 13.3 0 0 1 4.59 -.08l.456 .08l.396 .083l.161 -.1c1.385 -.84 2.487 -1.17 3.322 -1.148l.164 .008l.147 .017l.076 .014l.05 .011l.144 .047a1 1 0 0 1 .53 .514a5.2 5.2 0 0 1 .397 2.91l-.047 .267l-.046 .196l.123 .163c.574 .795 .93 1.728 1.03 2.707l.023 .295l.007 .272c0 3.855 -1.659 5.883 -4.644 6.68l-.245 .061l-.132 .029l.014 .161l.008 .157l.004 .365l-.002 .213l-.003 3.834a1 1 0 0 1 -.883 .993l-.117 .007h-6a1 1 0 0 1 -.993 -.883l-.007 -.117v-.734c-1.818 .26 -3.03 -.424 -4.11 -1.878l-.535 -.766c-.28 -.396 -.455 -.579 -.589 -.644l-.048 -.019a1 1 0 0 1 .564 -1.918c.642 .188 1.074 .568 1.57 1.239l.538 .769c.76 1.079 1.36 1.459 2.609 1.191l.001 -.678l-.018 -.168a5.03 5.03 0 0 1 -.021 -.824l.017 -.185l.019 -.12l-.108 -.024c-2.976 -.71 -4.703 -2.573 -4.875 -6.139l-.01 -.31l-.004 -.292a5.6 5.6 0 0 1 .908 -3.051l.152 -.222l.122 -.163l-.045 -.196a5.2 5.2 0 0 1 .145 -2.642l.1 -.282l.106 -.253a1 1 0 0 1 .529 -.514l.144 -.047l.154 -.03z"/>
                    </svg>
                </a>
            </li>
        </ul>
    </div>
</nav>

<main class="article-list">
    <div class="article">
        <a href="#">Dear API Providers</a>
        <time>Oct 22, 2024</time>
    </div>

    <div class="article">
        <a href="#">Strings</a>
        <time>Aug 17, 2024</time>
    </div>

    <div class="article">
        <a href="#">Computer Memory</a>
        <time>Apr 13, 2024</time>
    </div>

    <div class="quote">
        <div class="quote-contents">
            <p>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Atque blanditiis debitis error expedita hic,
                nesciunt, perferendis quae quaerat quia quo quod totam ullam veritatis. Beatae cumque ducimus placeat
                quae voluptatibus.
            </p>
        </div>
        <time>Apr 13, 2024</time>
    </div>

    <div class="article">
        <a href="#">Some personal updates</a>
        <time>Apr 13, 2024</time>
    </div>

    <div class="article">
        <a href="#">Dry</a>
        <time>May 23, 2024</time>
    </div>


    <div class="article">
        <a href="#">When your code time-travels</a>
        <time>Feb 15, 2024</time>
    </div>
</main>

<main class="article">
    <header>
        <h1>Dear API Providers</h1>
        <ul class="article-parameters">
            <li>Oct 22, 2024</li>
            <li>Misir Jafarov</li>
        </ul>
    </header>
    <article>
        <p>I writing this article as a manifestation and a cry for help to everyone being involved in designing and
            serving APIs to be consumed by external consumers.</p>
        <p>Please, just maintain stability of your APIs, don’t change name of a field because of some internal reason I
            am not concerned about, or heck don’t move the entire body into another object just because you can now
            claim to have a cleaner API design. As a consumer, the last thing I would care about is what are your
            internal struggles, struggles that are undocumented and have not been disclosed during integration phrase.
            Consumers want a peace of mind and stability. Otherwise changing software to fit third party’s changing
            needs is costly and time consuming exercise.</p>
        <p>Here, I will be sharing my experience working with lots of third party service providers ranging from CRMs,
            payment services, well known services like Firebase, to internal providers from another department within
            the same company.</p>
        <p>My common experience with those providers are the following:</p>
        <ul>
            <li>Breaking things for no good reason</li>
            <li>Not realizing scope of their changes</li>
            <li>And the worst of all, not properly communicating their changes</li>
            <li>Poor documentation</li>
            <li>Using assumptions instead of putting engineering guardrails to directing consumers</li>
        </ul>
        <h1 id="documentation">Documentation</h1>
        <p>Let me start from the last two points, where the pain started hitting when I first started integrating the
            provider. Third party API integration documentations are a common pain point among many service providers;
            they usually lack the empathy necessary to look at the problem from the consumer’s perspective and write out
            what they need.</p>
        <p>But you know what sucks more? A documentation that doesn’t have the valid material in it. Again, I have been
            working with many service providers around the world. It’s not the first time I am having the experience of
            manually testing each endpoint one by one and creating an ad-hoc documentation I can refer to internally. I
            learned to not trust any word third parties say, even their documentation. You better check it yourself and
            take a damn closer look at the requests and responses you are dealing with just to either build some
            confidence on the documentation or realize to not waste any time with it.</p>
        <p>I had a fairly recent interaction with some providers that suffered from documentation issues… What was their
            problem?
            Outdated documentation, mostly. Their response models was completely out of touch with the reality.</p>
        <p>On top of that documentation was unstructured and lacking important details like explanations of the
            enumeration parameters. In a slightly complex integration scenarios like webhooks, it’s worth investing a
            bit of time to create some illustrations for the data flow to show event timings and explain how the data
            flows among the bigger system.</p>
        <p><img src="https://i.imgur.com/GKQqUoC.png" alt="Stripe payment lifecycle"></p>
        <p>It doesn’t help with their situation that they decided to make major API structure changes 2 times, which I
            am going to talk separately about. Their unstructured documentation didn’t helped either. Nor the changes
            has been communicated properly.</p>
        <p>The way out of this situation I see is like this:</p>
        <ol>
            <li>Do not break the users</li>
            <li>If you do anyways, talk to your users and give them time and resources. Those resources should include
                what <strong>exactly</strong> needs to be changed, what are the <strong>excepted</strong> behavioral
                changes of the system.
            </li>
            <li>Monitor your migration process and communicate with your users!</li>
        </ol>
        <h1 id="breaking-the-compatibility">Breaking the compatibility</h1>
        <p>I do not like spreading my religious views, but if I have to spread one of my views, it would be this
            sentence from Linus Torvalds:</p>
        <blockquote>
            <p>We don’t break the userspace!</p>
        </blockquote>
        <p><a href="https://youtu.be/Pzl1B7nB9Kc?t=172">Linus Torvalds on why desktop Linux sucks [2:52]</a></p>
        <p>Userpsace here means the consumer side of the product Linus is maintaining (the Linux Kernel). With the same
            analogy the userspace is the API interface service providers expose. The problem with this approach is
            people are prone to making breaking changes unintentionally, I would like to list a few cases starting with
            the obvious ones:</p>
        <h2 id="do-not-change-your-public-api-interface-">Do not change your public API interface …</h2>
        <p>… (URLs, request, response models, headers, etc…) unless you have a really good reason. And no, I don’t care
            about your internal procedures. I don’t care if you have moved from ints to uuids on your database and
            asking us to except a string. That’s an irresponsible change on your end. Even if you must make a change
            because the third party service you are relying on made a bad decision, you are still the one to blame if
            you let the change to cascade into your users.</p>
        <p>Let’s say you decided to move anyway, then please refer to the <a href="#communication">communication</a>
            section down below to learn how to move with migration processes. And please keep old versions of your APIs
            available until you are confident (with a measurable metrics!) that you can deprecate the API.</p>
        <p>Starting July, 2024 firebase shut down its <em>legacy</em> HTTP api for sending notifications to user’s
            android phones. What they changed? The way they authenticate. Because previously they were using api tokens
            to authenticate those requests. For some reason they thought instead of a scoped down API key, using a
            service account that can be used to act on behalf of user if not configured properly is more secure. That
            was the first point on their reasoning. It just created me a few more hours of work to migrate everything to
            use FirebaseAdmin instead of just plain HTTP apis that was easier to test and integrate. I had to
            <em>extend</em> my configuration stack to load service account identification file from a separate path for
            authentication. They tried to avoid using api keys in favor of files that are still a big responsibility to
            store properly, can be leaked and cause damage, but it is more complicated to use if you don’t import their
            proprietary library into your codebase. Of course it is much more easier to integrate if you are hosting
            your app in <abbr title="Google Cloud Platform ">GCP</abbr> infrastructure, assuming you also know how to
            properly configure IAM settings to not expose your entire infrastructure vulnerable.</p>
        <h2 id="minor-changes">Minor changes</h2>
        <p><strong>DO NOT make any minor changes!</strong> Calling a change a “minor change” is just avoiding
            responsibility on your end. <a href="https://www.hyrumslaw.com">“Hyrum’s law”</a> states it the best:</p>
        <blockquote>
            <p>With a sufficient number of users of an API, it does not matter what you promise in the contract: all
                observable behaviors of your system will be depended on by somebody.</p>
        </blockquote>
        <p>If you have more than 3 users, please be respectful and at least be honest to yourself, do not downplay how
            much damage you can make by making small observable adjustments in your system.</p>
        <p><a href="https://xkcd.com/1172/"><img src="https://imgs.xkcd.com/comics/workflow_2x.png"
                                                 alt="XKCD: Workflow"></a></p>
        <p>Let me give you a concrete example. We had a payment provider we integrated with the software used by one of
            our clients. A few days ago the payment provider decided to start sending one additional <code>cardRegistration</code>
            field via their WebHook interface. Well, usually they would send this field only if we initiated the process
            with another specific endpoint used for card registration. We used the absence of
            <code>cardRegistration</code> field to communicate back our system which endpoint we used to initiate the
            process and handle accordingly. They probably deployed an update that is now sending <code>"cardRegistration":
                { "cardUid": "null", ... }</code> to us as a part of the response. Our system recognized this as a valid
            request for card registration and stored the card credentials (which is a string <code>"null"</code>) to be
            used afterwards. Well, within a day, over hundreds of orders stacked in the system from users trying to pay
            their dues using the card token <code>"null"</code>. Now users are probably angry at our client, the client
            is now angry at us, and now me pointing fingers to the provider. This could have been avoided if the scope
            of the change has been measured properly (and tested properly).</p>
        <p>Your assumptions about your users are <strong>WRONG</strong>! All of them! Do not expect them to behave the
            way you intended. You put possible guardrails in your API design, accept rest of the all possibilities.
            That’s also a good reason to keep exposed surface of your API endpoints to a minimum. I should have not
            relied on the absence of an arbitrary field to communicate some information back from a different part of
            the stack. I made a mistake by trusting the third party system, because they seemed reliable at the time of
            this integration. I assumed if there’s <code>cardRegistration</code> field, it sure means I can use it to
            register new card tokens. I shouldn’t have assumed this; Nor the provider should not have assumed that
            nobody had this assumption. It was a clearly observable behavior change that ended up causing lots of
            repetitional and financial damage.</p>
        <h2 id="shifting-the-blame">Shifting the blame</h2>
        <p>Blaming your users when they are not behaving the way you expected them to behave is just a terrible
            oversight on your end. I have personally felt the passive aggressive blame from local software shops selling
            CRM services to clients I personally work with. It’s not my mistake if your software crashes when I provide
            a data that’s clearly fits the format you provided. Look, I don’t say this shouldn’t happen, you can not
            avoid unforeseen behaviors entirely. How you deal with them is your responsibility. Acting insecure and
            pointing fingers does just portray a weakness.</p>
        <h1 id="communicate">Communicate</h1>
        <p>So you decided to make a change to the observable behavior of the system. I wish you didn’t but on a longer
            timescale change is unavoidable. What’s avoidable is the damage you would be incurring. You need to clearly
            communicate with your users, in a technical terms, explain what is <strong>exactly</strong> going to change,
            what are the observable changes you are expecting to pop up. And if possible provide a clear timeline.</p>
        <h2 id="observe-your-system">Observe your system</h2>
        <p>Please improve observability on your system. That’s one of the hard lessons I learned in last couple of years
            myself. To make helpful communication, you first need to let your system communicate its state back to
            you.</p>
        <p>Collect as much telemetry as possible from your system. If your only stored metrics are the logs inside
            <code>/var/nginx/logs/access.log</code>, you are not doing it right! Start logging, tracing and collecting
            all the application telemetry if possible into a central system (eg: ELK stack, CloudWatch, Seq, etc…).</p>
        <p>You need to make use of the data to see what you are missing. Start building useful dashboards. Use the
            dashboards to make technical and business decisions. You will find a lot of data missing. Add new tracing
            capabilities on your system to gather more data to have more clearer visibility. Rinse and repeat.</p>
        <p>If you are working with third parties, trace the communication interfaces. Have clear success metrics, error
            logs, timestamps, etc. Also create alarms that would page you back if something doesn’t look alright. A user
            constantly hitting your endpoint and getting 400 BadRequest is a good indicator that you probably have
            messed up something on your last batch of minor changes release.</p>
        <p>Once you have data to identify issues and observe the system, please communicate with your users if you
            suspect any unusual activity. The investment into system observability does usually pay a lot over time,
            mostly giving you numbers you can refer to and confidence to speak out. It will lower your guess work. On
            top of that I have seen it many times helping me identify very specific issues that I would otherwise
            couldn’t reproduce, debug and figure out. It will take quite a time until you start to make sense of data
            you have collected. Let it take the time it needs, the experience will be paid off in dividends later
            on.</p>
        <p>Back to the main topic, communicate your findings with your users. You can do so much with those numbers to
            make life easier for your users. During migration you can keep track of the adaption by users and decide
            when you can deprecate older APIs, or communicate with users to learn their pain points. Act quickly when
            experiencing sudden increase in errors.</p>
        <h1 id="conclusion">Conclusion</h1>
        <p>As a service provider, you will be held responsible for your own actions. To avoid as much damage as
            possible, timely communication is a must have skill you need to master. You need to understand your
            responsibilities and be brave enough to apologize when necessary. You need to understand your users and your
            system. You need data, as much data as possible until you can effectively utilize them. Use data as a
            leverage on your choices. Be vigilant, act before it’s too late to avoid further damages.</p>
        <p>I am myself providing services to companies that are relying on software I build. Tens of thousands users
            around the globe are interacting with them almost daily.</p>
        <p>I am also learning, and trying to improve as a service provider. For example I would not consider myself good
            at communication part, but that has been improved quite a lot over the years. I can still see further
            improvement on my end and I am trying to get better it. I learned to take responsibilities at face and
            navigate at the hard times. I understand the struggles of the service providers.</p>
        <p>That’s why I also share my experience, especially putting emphasis on engineering solutions we can use like
            observability and using data we gathered to better optimize our workflow.</p>
    </article>
</main>

<footer>
    <ul class="footer-links">
        <li>
            Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 with Modifications</a>
        </li>
        <li>
            Powered by <a href="https://gohugo.io/">Hugo</a>
        </li>
    </ul>
</footer>


</body>
</html>